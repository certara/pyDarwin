

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 4: PK Model, DMAG by GA with post-run R code &mdash; pyDarwin 3.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=0f71c7ad" />

  
      <script src="_static/documentation_options.js?v=dd1205ac"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pyDarwin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Releases.html">Releases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="Options.html">Options List</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="NLME.html">NLME integration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyDarwin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example 4: PK Model, DMAG by GA with post-run R code</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-4-pk-model-dmag-by-ga-with-post-run-r-code">
<span id="startpk4"></span><h1>Example 4: PK Model, DMAG by GA with post-run R code<a class="headerlink" href="#example-4-pk-model-dmag-by-ga-with-post-run-r-code" title="Link to this heading">¶</a></h1>
<p>Example 4 uses a dataset simulated from the following <a class="reference external" href="https://www.nimh.nih.gov/funding/clinical-research/practical/catie#:~:text=The%20NIMH%2Dfunded%20Clinical%20Antipsychotic,medications%20used%20to%20treat%20schizophrenia">CATIE study</a> ,
courtesy of <a class="reference external" href="https:/pharmacy.buffalo.edu/content/pharmacy/faculty-staff/faculty-profile.html?ubit=robertbi">Dr. Rob Bies</a> .
This search again uses <a class="reference internal" href="Glossary.html#nested-tokens"><span class="std std-ref">nested tokens</span></a>, as it searches whether K32 is a function of Weight, and 1 vs 2 vs 3 compartments.
Another important feature of example 4 is the use of post run R code. In this case, it was of interest to capture the Cmax value. There is no straightforward way to include a penalty for
missing the Cmax
in the NONMEM control stream. Therefore, the penalty for missing Cmax is added after the NONMEM run is complete. Any R code can be provided by the user and should return a vector of two values. The
first is a real values penalty to be added to the fitness/reward. The 2nd is text that will be appended to the NONMEM output file to describe the results of the R code execution.</p>
<p>The penalty for missing the Cmax is essentially a <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/11381569/">Posterior Predictive Check (PPC)</a>. The template file includes two tasks
that are used to generate a table of the PPC: an estimation, followed by a simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PROB SIMULATION FOR CMAX

$INPUT       ID TIME AMT {D1LAG[1]} DV MDV EVID WT AGE SEX BUN SCR OCC CRCL COV1 COV2
$DATA      {data_dir}/dataWithPeriod.csv IGNORE=@  REWIND
$MSFI = MSF1
$SIMULATION (1) ONLYSIM
$TABLE REP ID TIME IOBS EVID  NOAPPEND NOPRINT FILE = SIM.DAT ONEHEADER NOAPPEND
</pre></div>
</div>
<p>User provided R code is then saved to a file (<code class="docutils literal notranslate"><span class="pre">.R</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>library(dplyr)
orgdata &lt;-  read.table(&quot;ORG.DAT&quot;,skip=1,header=TRUE)
orgdata &lt;- orgdata[orgdata$EVID==0&amp;orgdata$TIME&lt;=24,] # only first 24 hours
simdata &lt;-  read.table(&quot;SIM.DAT&quot;,skip=1,header=TRUE) # only first 24 hours
simdata &lt;- simdata[orgdata$EVID==0&amp;orgdata$TIME&lt;=24,]
observed_maxes &lt;- orgdata %&gt;% group_by(ID) %&gt;%
summarise(max = max(DV))
sim_maxes &lt;- simdata %&gt;% group_by(ID) %&gt;% summarise(max = max(IOBS))
# penalty of 4 points for each % difference
obs_geomean = exp(mean(log(observed_maxes$max)))
sim_geomean = exp(mean(log(sim_maxes$max)))
penalty &lt;- 4*abs((obs_geomean-sim_geomean)/obs_geomean)*100
text &lt;- paste0(&quot;Observed day 1 Cmax geomean = &quot;, round(obs_geomean,1), &quot; simulated day 1 Cmax geo mean = &quot;, round(sim_geomean,1))
c(penalty,text)
</pre></div>
</div>
<p>The R code executes from the run directory of that model. For example, if a model runs in <code class="docutils literal notranslate"><span class="pre">c:\\pydarwin\\example4\\00\\04</span></code>, the <code class="docutils literal notranslate"><span class="pre">ORG.DAT</span></code> and <code class="docutils literal notranslate"><span class="pre">SIM.DAT</span></code>
files will be written to that directory and the R code will be read from the same directory.</p>
<p>This R code returns a character vector of length 2. The first is a string that can be read as numeric (penalty) and the 2nd is a string that is appended to the
NONMEM output file, as a comment to document the output of the R code. The content of the 2nd element of the vector is entirely up to the user, it has no
impact on the pyDarwin process, it is just appended to the output file.</p>
<p>The first element of the returned value is added to the fitness/reward value and is then used in the selection of subsequent populations, just as any other penalty. The
penalty value can be any real value - including negative, but typically would be positive.</p>
<p>The post processing code options are given in the options file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;postprocess&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;use_r&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;post_run_r_code&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{project_dir}</span><span class="s2">/Cmaxppc.r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rscript_path&quot;</span><span class="p">:</span> <span class="s2">&quot;c:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">R</span><span class="se">\\</span><span class="s2">R-4.1.3</span><span class="se">\\</span><span class="s2">bin</span><span class="se">\\</span><span class="s2">Rscript.exe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;r_timeout&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;use_python&quot;</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>Be sure to set <code class="docutils literal notranslate"><span class="pre">&quot;use_r&quot;:</span> <span class="pre">true</span></code> to use R for post processing. Additionally, include the path to the R code (<code class="docutils literal notranslate"><span class="pre">&quot;post_run_r_code&quot;</span></code>), the path to Rscript.exe (<code class="docutils literal notranslate"><span class="pre">&quot;r_script_path&quot;</span></code>), and the timeout (<code class="docutils literal notranslate"><span class="pre">&quot;r_timeout&quot;</span></code>), after which the R session will be terminated if not
complete and the <a class="reference internal" href="Glossary.html#crash-value"><span class="std std-ref">crash_value</span></a> added as the penalty.</p>
<section id="the-template-file">
<h2>The Template file<a class="headerlink" href="#the-template-file" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PROBLEM    2 compartment fitting
$INPUT       ID TIME AMT {D1LAG[1]} DV MDV EVID WT AGE SEX BUN SCR OCC CRCL COV1 COV2

$DATA      {data_dir}/dataWithPeriod.csv IGNORE=@

$SUBROUTINE {ADVAN[1]}
$PK
CWTKGONE = WT/81  ;; WEIGHT CENTERED ON ONE
CWTKGZERO = WT-81 ;; WEIGHT CENTERED ON ZERO
CAGE = AGE/60     ;; AGE CENTERED ON ONE
CCRCL = CRCL/85.6 ;; CRCL CENTERD ON ONE
CCOV1 = COV1-15.4 ;; COVARIATE 1 CENTERED ON ZERO
{IOVV[1]}
TVV2=THETA(1) {V2~WT[1]} {V2~SEX[1]} {V2~AGE[1]} {V2~COV2[1]}  *EXP(IOVV)
V2=TVV2*EXP(ETA(2))
{IOVCL[1]}
TVCL= {INITCL[1]} {CL~WT[1]} {CL~AGE[1]} {CL~CRCL[1]} {CL~COV1[1]} *EXP(IOVCL)
CL=TVCL*EXP(ETA(1))

K=CL/V2
{ADVAN[2]}
{D1LAG[2]}
TVKA=THETA(2)
KA=TVKA  {KAETA[1]}
S2 = V2
$ERROR
REP = IREP
IPRED =F
IOBS = F {RESERR[1]}
Y=IOBS
$THETA
(0.001,100)         ; THETA(1) V  UNITS = L
(0.001, 10)         ; THETA(2) KA UNITS = 1/HR
{INITCL[2]} ; THETA(INITCL) CL UNITS =  L/HR
{ADVAN[3]}
{V2~WT[2]}
{V2~SEX[2]}
{V2~AGE[2]}
{V2~COV2[2]}
{CL~WT[2]}
{CL~AGE[2]}
{CL~CRCL[2]}
{CL~COV1[2]}
{D1LAG[3]}
$OMEGA
0.1                 ; ETA(1) CLEARANCE
0.4                 ; ETA(2) VOLUME
{KAETA[2]}
{D1LAG[4]}
{IOVCL[2]}
{IOVV[2]}
$SIGMA
{RESERR[2]}

$EST METHOD=COND INTER MAX = 9999 MSFO=MSF1 PRINT = 10
$COV UNCOND PRINT=E  PRECOND=1 PRECONDS=TOS  MATRIX = R

$TABLE REP ID TIME DV EVID NOPRINT FILE = ORG.DAT ONEHEADER NOAPPEND

$PROB SIMULATION FOR CMAX

$INPUT       ID TIME AMT {D1LAG[1]} DV MDV EVID WT AGE SEX BUN SCR OCC CRCL COV1 COV2
$DATA      {data_dir}/dataWithPeriod.csv IGNORE=@  REWIND
$MSFI = MSF1
$SIMULATION (1) ONLYSIM
$TABLE REP ID TIME IOBS EVID  NOAPPEND NOPRINT FILE = SIM.DAT ONEHEADER NOAPPEND
</pre></div>
</div>
<p>Example 4 template file: <a class="reference download internal" download="" href="_downloads/6883e4596b34b3b57cf0b0169ae72f30/template.txt"><code class="xref download docutils literal notranslate"><span class="pre">text</span></code></a></p>
</section>
<section id="the-tokens-file">
<h2>The Tokens file<a class="headerlink" href="#the-tokens-file" title="Link to this heading">¶</a></h2>
<p>Nothing new in the tokens file, we see again an example of nested tokens:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;ADVAN&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;ADVAN2 ;; advan2&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;;; PK 1 compartment &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;;; THETA 1 compartment&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;ADVAN4 ;; advan4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;K23=THETA(ADVANA){K23~WT[1]}</span><span class="se">\n</span><span class="s2">  K32=THETA(ADVANB){K23~WT[1]}&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0.001,0.02)  </span><span class="se">\t</span><span class="s2"> ; THETA(ADVANA) K23 </span><span class="se">\n</span><span class="s2"> (0.001,0.3) </span><span class="se">\t</span><span class="s2"> ; THETA(ADVANB) K32 </span><span class="se">\n</span><span class="s2">{K23~WT[2]} </span><span class="se">\t</span><span class="s2"> ; init for K23~WT &quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;ADVAN12 ;; advan12&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;K23=THETA(ADVANA){K23~WT[1]}</span><span class="se">\n</span><span class="s2">  K32=THETA(ADVANB){K23~WT[1]}</span><span class="se">\n</span><span class="s2">  K24=THETA(ADVANC)</span><span class="se">\n</span><span class="s2">  K42=THETA(ADVAND)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0.001,0.1) </span><span class="se">\t</span><span class="s2">; THETA(ADVANA) K23 </span><span class="se">\n</span><span class="s2"> (0.001,0.1)</span><span class="se">\t</span><span class="s2">; THETA(ADVANB) K32 </span><span class="se">\n</span><span class="s2"> (0.001,0.1) </span><span class="se">\t</span><span class="s2">; THETA(ADVANC) K24  </span><span class="se">\n</span><span class="s2"> (0.001,0.1) </span><span class="se">\t</span><span class="s2">; THETA(ADVAND) K42  </span><span class="se">\n</span><span class="s2"> {K23~WT[2]} </span><span class="se">\t</span><span class="s2"> ;; init for K23~WT&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;K23~WT&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CWTKGONE**THETA(K23~WT)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0,0.1) </span><span class="se">\t</span><span class="s2">; THETA(K23~WT) K23~WT&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;KAETA&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(ETA(KAETA)) &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA ;; 2nd OMEGA block </span><span class="se">\n</span><span class="s2">0.1</span><span class="se">\t\t</span><span class="s2">; ETA(KAETA) ETA ON KA&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;V2~WT&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CWTKGONE**THETA(V2~WT)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,0.8) </span><span class="se">\t</span><span class="s2">; THETA(V2~WT) POWER volume ~WT &quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(CWTKGZERO*THETA(V2~WT))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-1,0.01) </span><span class="se">\t</span><span class="s2">; THETA(V2~WT) EXPONENTIAL volume ~WT &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;V2~AGE&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CAGE**THETA(V2~AGE)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,0.8) </span><span class="se">\t</span><span class="s2">; THETA(V2~AGE) POWER volume ~AGE &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>

    <span class="s2">&quot;V2~SEX&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(SEX*THETA(V2~SEX))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,0.1) </span><span class="se">\t</span><span class="s2">; THETA(V2~SEX) EXPONENTIAL volume~SEX &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;V2~COV2&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(COV2*THETA(V2~COV2))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,0.1) </span><span class="se">\t</span><span class="s2">; THETA(V2~COV2) EXPONENTIAL volume ~COV2 &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;CL~WT&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CWTKGONE**THETA(CL~WT)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,.7) </span><span class="se">\t</span><span class="s2">; THETA(CL~WT) POWER clearance~WT &quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(CWTKGZERO*THETA(CL~WT))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-1,0.01) </span><span class="se">\t</span><span class="s2">; THETA(CL~WT) EXPONENTIAL clearance~WT &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;CL~AGE&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CAGE**THETA(CL~AGE)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,.7) </span><span class="se">\t</span><span class="s2">; THETA(CL~AGE) POWER clearance~AGE &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;CL~CRCL&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*CCRCL**THETA(CL~CRCL)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,-0.2) </span><span class="se">\t</span><span class="s2">; THETA(CL~CRCL) POWER clearance~CRCL &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;CL~COV1&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>

            <span class="p">[</span><span class="s2">&quot;*EXP(CCOV1*THETA(CL~COV1))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(-4,0.1) </span><span class="se">\t</span><span class="s2">; THETA(CL~COV1) EXPONENTIAL CL~COV1 &quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;IOVCL&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;IF(OCC.EQ.1) IOVCL = ETA(IOVCLA) </span><span class="se">\n</span><span class="s2">  IF(OCC.EQ.2) IOVCL = ETA(IOVCLB) </span><span class="se">\n</span><span class="s2">  IF(OCC.EQ.3) IOVCL = ETA(IOVCLC)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA BLOCK(1) ; ETA(IOVCLA)</span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\n</span><span class="s2"> $OMEGA BLOCK SAME ; ETA(IOVCLB)</span><span class="se">\n</span><span class="s2"> $OMEGA BLOCK SAME ; ETA(IOVCLC)&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;IOVCL = 0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;;; no iov ON CL&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;IOVV&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;IF(OCC.EQ.1) IOVV = ETA(IOVVA) </span><span class="se">\n</span><span class="s2">  IF(OCC.EQ.2) IOVV = ETA(IOVVB) </span><span class="se">\n</span><span class="s2">  IF(OCC.EQ.3) IOVV = ETA(IOVVC)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA BLOCK(1) ; ETA(IOVVA)</span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\n</span><span class="s2">$OMEGA BLOCK SAME ; ETA(IOVVB)</span><span class="se">\n</span><span class="s2">$OMEGA BLOCK SAME ; ETA(IOVVC)&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;IOVV = 0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;;; no iov ON V&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>

    <span class="s2">&quot;INITCL&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;THETA(INITCL)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(0.001,2)&quot;</span>
       <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;THETA(INITCL)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(0.001,20)&quot;</span>
    <span class="p">]</span>
  <span class="p">],</span>

    <span class="s2">&quot;ETAD1LAG&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(ETA(ETALAG))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA ;; 3rd OMEGA block </span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG) ETA ON ALAG1&quot;</span>
                    <span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;*EXP(ETA(ETALAG1))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA ;;  </span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG1) ETA ON D1&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(ETA(ETALAG1))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;*EXP(ETA(ETALAG2))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA  ;; diagonal OMEGA </span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG1) ETA ON ALAG1</span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG2) ETA ON D1&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(ETA(ETALAG1))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;*EXP(ETA(ETALAG2))&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;$OMEGA BLOCK(2) ;; block OMEGA block </span><span class="se">\n</span><span class="s2"> 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG1) ETA ON ALAG1</span><span class="se">\n</span><span class="s2"> 0.01 0.1 </span><span class="se">\t\t</span><span class="s2">;; ETA(ETALAG2) ETA ON D1&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;D1LAG&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;DROP&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ALAG1=THETA(ALAG)</span><span class="si">{ETAD1LAG[1]}</span><span class="se">\n</span><span class="s2">;; No D1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0.001,0.1) </span><span class="se">\t</span><span class="s2">; THETA(ALAG) ALAG1   &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">{ETAD1LAG[3]}</span><span class="s2">&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;RATE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot; D1=THETA(D1) </span><span class="si">{ETAD1LAG[1]}</span><span class="s2"> ; infusion only&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0.01,0.2) </span><span class="se">\t\t</span><span class="s2">;; THETA(D1) D1  &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">{ETAD1LAG[3]}</span><span class="s2">  &quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;RATE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot; ALAG1=THETA(ALAG)</span><span class="si">{ETAD1LAG[1]}</span><span class="se">\n</span><span class="s2">  D1=THETA(D1)</span><span class="si">{ETAD1LAG[2]}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;(0.001,0.1,1) </span><span class="se">\t\t</span><span class="s2">;; THETA(ALAG) ALAG1</span><span class="se">\n</span><span class="s2"> (0.001,0.1,1) ;;THETA(D1) D1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">{ETAD1LAG[3]}</span><span class="s2"> </span><span class="se">\t\t</span><span class="s2">;; D1 and lag, block&quot;</span>
            <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;RESERR&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;*EXP(EPS(RESERRA))+EPS(RESERRB)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot; 0.1 </span><span class="se">\t</span><span class="s2">; EPS(RESERRA) proportional error</span><span class="se">\n</span><span class="s2">  100 </span><span class="se">\t</span><span class="s2">; EPS(RESERRB) additive error&quot;</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;+EPS(RESERRA)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot; 200 </span><span class="se">\t</span><span class="s2">; EPS(RESERRA) additive error&quot;</span>
            <span class="p">]</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note again, the use of THETA(parameter identifier), e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span>  \<span class="n">t</span> <span class="p">;</span> <span class="n">THETA</span><span class="p">(</span><span class="n">ADVANA</span><span class="p">)</span> <span class="n">K23</span>
</pre></div>
</div>
<p>for <strong>ALL</strong> initial estimate token text (THETA, OMEGA, and SIGMA).</p>
<p>Example 4 tokens file: <a class="reference download internal" download="" href="_downloads/510c9b8465a775a5828463746fc5632a/tokens.json"><code class="xref download docutils literal notranslate"><span class="pre">json</span></code></a></p>
</section>
<section id="the-options-file">
<h2>The Options file<a class="headerlink" href="#the-options-file" title="Link to this heading">¶</a></h2>
<p>The algorithm selection in the options file is <a class="reference internal" href="Algorithms.html#ga-desc"><span class="std std-ref">GA</span></a>.</p>
<p>The user should provide an appropriate path for <a class="reference internal" href="Options.html#nmfe-path-options-desc"><span class="std std-ref">“nmfe_path”</span></a>. NONMEM version 7.4 and 7.5 are supported.</p>
<p>Note that, to run in the environment used for this example, the directories are set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;u:/pyDarwin/example4/working&quot;</span><span class="p">,</span>
<span class="s2">&quot;temp_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;u:/pyDarwin/example4/rundir&quot;</span><span class="p">,</span>
<span class="s2">&quot;output_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;u:/pyDarwin/example4/output&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>It is recommended that the user set the directories to something appropriate for their environment. If directories are not set,
the default is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">user_dir</span><span class="p">}</span>\<span class="n">pydarwin</span>\<span class="p">{</span><span class="n">project_name</span><span class="p">}</span>
</pre></div>
</div>
<p>In either case, the folder names are given in the initial and final output to facilitate finding the files and debugging.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Certara&quot;</span><span class="p">,</span>
 <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;GA&quot;</span><span class="p">,</span>

 <span class="s2">&quot;GA&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;crossover_rate&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
     <span class="s2">&quot;elitist_num&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
     <span class="s2">&quot;mutation_rate&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
     <span class="s2">&quot;attribute_mutation_probability&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
     <span class="s2">&quot;mutate&quot;</span><span class="p">:</span> <span class="s2">&quot;flipBit&quot;</span><span class="p">,</span>
     <span class="s2">&quot;niche_penalty&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
     <span class="s2">&quot;selection&quot;</span><span class="p">:</span> <span class="s2">&quot;tournament&quot;</span><span class="p">,</span>
     <span class="s2">&quot;selection_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s2">&quot;sharing_alpha&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
     <span class="s2">&quot;crossover_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;cxOnePoint&quot;</span>
 <span class="p">},</span>

 <span class="s2">&quot;random_seed&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
 <span class="s2">&quot;population_size&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
 <span class="s2">&quot;num_parallel&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s2">&quot;num_generations&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>

 <span class="s2">&quot;downhill_period&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s2">&quot;num_niches&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s2">&quot;niche_radius&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s2">&quot;local_2_bit_search&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
 <span class="s2">&quot;final_downhill_search&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>

 <span class="s2">&quot;crash_value&quot;</span><span class="p">:</span> <span class="mi">99999999</span><span class="p">,</span>

 <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="s2">&quot;omega&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="s2">&quot;convergence&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="s2">&quot;covariance&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="s2">&quot;correlation&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="s2">&quot;condition_number&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="s2">&quot;non_influential_tokens&quot;</span><span class="p">:</span> <span class="mf">0.00001</span>
 <span class="p">},</span>

 <span class="s2">&quot;remove_run_dir&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>

 <span class="s2">&quot;nmfe_path&quot;</span><span class="p">:</span> <span class="s2">&quot;c:/nm744/util/nmfe74.bat&quot;</span><span class="p">,</span>
 <span class="s2">&quot;model_run_timeout&quot;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>

 <span class="s2">&quot;postprocess&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;use_r&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
     <span class="s2">&quot;post_run_r_code&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{project_dir}</span><span class="s2">/Cmaxppc.r&quot;</span><span class="p">,</span>
     <span class="s2">&quot;rscript_path&quot;</span><span class="p">:</span> <span class="s2">&quot;c:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">R</span><span class="se">\\</span><span class="s2">R-4.1.3</span><span class="se">\\</span><span class="s2">bin</span><span class="se">\\</span><span class="s2">Rscript.exe&quot;</span><span class="p">,</span>
     <span class="s2">&quot;r_timeout&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
     <span class="s2">&quot;use_python&quot;</span><span class="p">:</span> <span class="n">false</span>
 <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Example 4 options file: <a class="reference download internal" download="" href="_downloads/b05a30f00e0224edc0d19d0af2523cd3/options.json"><code class="xref download docutils literal notranslate"><span class="pre">json</span></code></a></p>
</section>
<section id="execute-search">
<h2>Execute Search<a class="headerlink" href="#execute-search" title="Link to this heading">¶</a></h2>
<p>Usage details for starting a search in <code class="docutils literal notranslate"><span class="pre">pyDarwin</span></code> can be found <a class="reference internal" href="Usage.html#execution"><span class="std std-ref">here</span></a>.</p>
<p>See <a class="reference internal" href="Examples.html#examples-target"><span class="std std-ref">“Examples”</span></a> for additional details about accessing example files.</p>
<p>The search space contains 1.66 million possible models, and searches for the following:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Token Stem</p></th>
<th class="head"><p>Values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Number of compartments</p></td>
<td><p>ADVAN</p></td>
<td><p>1|2|3</p></td>
</tr>
<tr class="row-odd"><td><p>Is K23 related to weight?</p></td>
<td><p>K23~WT</p></td>
<td><p>Yes|No</p></td>
</tr>
<tr class="row-even"><td><p>Is there ETA on Ka?</p></td>
<td><p>KAETA</p></td>
<td><p>Yes|No</p></td>
</tr>
<tr class="row-odd"><td><p>Is V2 related to weight?</p></td>
<td><p>V2~WT</p></td>
<td><p>None|Power|exponential</p></td>
</tr>
<tr class="row-even"><td><p>Is V2 related to Gender?</p></td>
<td><p>V2~GENDER</p></td>
<td><p>Yes|No</p></td>
</tr>
<tr class="row-odd"><td><p>Is CL related to weight?</p></td>
<td><p>CL~WT</p></td>
<td><p>None|Power|exponential</p></td>
</tr>
<tr class="row-even"><td><p>Is CL related to Age?</p></td>
<td><p>CL~AGE</p></td>
<td><p>Yes|No</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Is there ETA on D1</div>
<div class="line">and/or ALAG1 (nested in</div>
<div class="line">the D1LAG token group)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ETAD1LAG</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">None or ETA on D1 or</div>
<div class="line">ETA on ALAGa or</div>
<div class="line">ETA on both (BLOCK)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>In practice, we will be searching for:</p>
<ol class="arabic simple">
<li><p>1,2,3 compartments</p></li>
<li><p>Between occasion variability</p></li>
<li><p>Multiple covariates (but probably still not as many as a real search)</p></li>
<li><p>Different absorption models</p></li>
<li><p>Different residual error models</p></li>
<li><p>Block OMEGA structures</p></li>
<li><p>Different initial estimates (also likely not as many as a real search should include).</p></li>
</ol>
<p>As the search space is large, we’ll plan a large sample (population size of 80, with 12 generations). While <a class="reference internal" href="Algorithms.html#gp-desc"><span class="std std-ref">Gaussian Process</span></a> may be more efficient
in terms of number of models to convergence, once ~500 samples are defined, the <a class="reference external" href="https://scikit-optimize.github.io/stable/modules/optimizer.html#">ask step</a> becomes long,
negating any efficiency of the algorithm.</p>
<p>Below is a table of the ask and tell step times  (hh:mm:ss), by iteration for GP. The sample size was 80, with 4 chains on a 4 core computer:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>iteration</p></th>
<th class="head"><p>ask</p></th>
<th class="head"><p>tell</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td></td>
<td><p>0:00:15</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>0:01:18</p></td>
<td><p>0:00:35</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>0:03:12</p></td>
<td><p>0:01:03</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>0:05:56</p></td>
<td><p>0:01:55</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>0:09:33</p></td>
<td><p>0:03:55</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>0:16:22</p></td>
<td><p>0:04:47</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>0:25:25</p></td>
<td><p>0:08:30</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>0:33:43</p></td>
<td><p>0:09:30</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>0:50:11</p></td>
<td><p>0:10:26</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>0:55:32</p></td>
<td><p>0:13:52</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>1:09:00</p></td>
<td><p>0:17:14</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>1:22:18</p></td>
<td><p>0:21:14</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>1:40:25</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>In contrast, GA execution time for the next generation sample is short (a few seconds) and independent of the cumulative sample size.</p>
<p>Initialization output should look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Options</span> <span class="n">file</span> <span class="n">found</span> <span class="n">at</span> <span class="o">..</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>\<span class="n">options</span><span class="o">.</span><span class="n">json</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Preparing</span> <span class="n">project</span> <span class="n">working</span> <span class="n">folder</span><span class="o">...</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Preparing</span> <span class="n">project</span> <span class="n">output</span> <span class="n">folder</span><span class="o">...</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Preparing</span> <span class="n">project</span> <span class="n">temp</span> <span class="n">folder</span><span class="o">...</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Model</span> <span class="n">run</span> <span class="n">priority</span> <span class="ow">is</span> <span class="n">below_normal</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Using</span> <span class="n">darwin</span><span class="o">.</span><span class="n">MemoryModelCache</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Project</span> <span class="nb">dir</span><span class="p">:</span> <span class="n">c</span><span class="p">:</span>\<span class="n">fda</span>\<span class="n">pyDarwin</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Data</span> <span class="nb">dir</span><span class="p">:</span> <span class="n">c</span><span class="p">:</span>\<span class="n">fda</span>\<span class="n">pyDarwin</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Project</span> <span class="n">working</span> <span class="nb">dir</span><span class="p">:</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">working</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Project</span> <span class="n">temp</span> <span class="nb">dir</span><span class="p">:</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">rundir</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Project</span> <span class="n">output</span> <span class="nb">dir</span><span class="p">:</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">output</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Writing</span> <span class="n">intermediate</span> <span class="n">output</span> <span class="n">to</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">output</span>\<span class="n">results</span><span class="o">.</span><span class="n">csv</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Models</span> <span class="n">will</span> <span class="n">be</span> <span class="n">saved</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">working</span>\<span class="n">models</span><span class="o">.</span><span class="n">json</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Template</span> <span class="n">file</span> <span class="n">found</span> <span class="n">at</span> <span class="o">..</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>\<span class="n">template</span><span class="o">.</span><span class="n">txt</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Tokens</span> <span class="n">file</span> <span class="n">found</span> <span class="n">at</span> <span class="o">..</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>\<span class="n">tokens</span><span class="o">.</span><span class="n">json</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Search</span> <span class="n">start</span> <span class="n">time</span> <span class="o">=</span> <span class="n">Mon</span> <span class="n">Aug</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span> <span class="mi">2022</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="o">--</span> <span class="n">Starting</span> <span class="n">Generation</span> <span class="mi">0</span> <span class="o">--</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">NMFE</span> <span class="n">found</span><span class="p">:</span> <span class="n">c</span><span class="p">:</span><span class="o">/</span><span class="n">nm744</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="n">nmfe74</span><span class="o">.</span><span class="n">bat</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">RScript</span> <span class="n">found</span> <span class="n">at</span> <span class="n">c</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">R</span>\<span class="n">R</span><span class="o">-</span><span class="mf">4.1.3</span>\<span class="nb">bin</span>\<span class="n">Rscript</span><span class="o">.</span><span class="n">exe</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Post</span> <span class="n">Run</span> <span class="n">R</span> <span class="n">code</span> <span class="n">found</span> <span class="n">at</span> <span class="n">c</span><span class="p">:</span>\<span class="n">fda</span>\<span class="n">pyDarwin</span>\<span class="n">examples</span>\<span class="n">user</span>\<span class="n">Example4</span>\<span class="n">Cmaxppc</span><span class="o">.</span><span class="n">r</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Not</span> <span class="n">using</span> <span class="n">Post</span> <span class="n">Run</span> <span class="n">Python</span> <span class="n">code</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Checking</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>\<span class="n">pyDarwin</span>\<span class="n">example4</span>\<span class="n">rundir</span>\<span class="mi">00</span>\<span class="mi">01</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Data</span> <span class="nb">set</span> <span class="c1"># 1 was found: c:\fda\pyDarwin\examples\user\Example4/dataWithPeriod.csv</span>
    <span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="n">Data</span> <span class="nb">set</span> <span class="c1"># 2 was found: c:\fda\pyDarwin\examples\user\Example4/dataWithPeriod.csv</span>
</pre></div>
</div>
<p>After a few seconds, the NONMEM execution should begin, with output like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">52</span><span class="p">]</span> <span class="n">Generation</span> <span class="o">=</span> <span class="mi">00</span><span class="p">,</span> <span class="n">Model</span>     <span class="mi">2</span><span class="p">,</span> <span class="n">Post</span> <span class="n">process</span> <span class="n">R</span> <span class="n">failed</span><span class="p">,</span>    <span class="n">fitness</span> <span class="o">=</span> <span class="mi">99999999</span><span class="p">,</span>    <span class="n">message</span> <span class="o">=</span> <span class="n">No</span> <span class="n">important</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">K32</span><span class="p">,</span> <span class="n">OR</span> <span class="n">K42</span> <span class="n">IS</span> <span class="n">TOO</span> <span class="n">CLOSE</span> <span class="n">TO</span> <span class="n">AN</span> <span class="n">EIGENVALUE</span>
<span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">54</span><span class="p">]</span> <span class="n">Generation</span> <span class="o">=</span> <span class="mi">00</span><span class="p">,</span> <span class="n">Model</span>     <span class="mi">3</span><span class="p">,</span> <span class="n">Post</span> <span class="n">process</span> <span class="n">R</span> <span class="n">failed</span><span class="p">,</span>    <span class="n">fitness</span> <span class="o">=</span> <span class="mi">99999999</span><span class="p">,</span>    <span class="n">message</span> <span class="o">=</span> <span class="n">NON</span><span class="o">-</span><span class="n">FIXED</span> <span class="n">OMEGA</span> <span class="n">NON</span><span class="o">-</span><span class="n">FIXED</span> <span class="n">PARAMETER</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">K32</span><span class="p">,</span> <span class="n">OR</span> <span class="n">K42</span> <span class="n">IS</span> <span class="n">TOO</span> <span class="n">CLOSE</span> <span class="n">TO</span> <span class="n">AN</span> <span class="n">EIGENVALUE</span> <span class="n">OCCURS</span> <span class="n">DURING</span> <span class="n">SEARCH</span> <span class="n">FOR</span> <span class="n">ETA</span> <span class="n">AT</span> <span class="n">INITIAL</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">ETA</span><span class="o">=</span><span class="mi">0</span>
<span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">56</span><span class="p">]</span> <span class="n">Generation</span> <span class="o">=</span> <span class="mi">00</span><span class="p">,</span> <span class="n">Model</span>     <span class="mi">1</span><span class="p">,</span> <span class="n">Post</span> <span class="n">process</span> <span class="n">R</span> <span class="n">failed</span><span class="p">,</span>    <span class="n">fitness</span> <span class="o">=</span> <span class="mi">99999999</span><span class="p">,</span>    <span class="n">message</span> <span class="o">=</span> <span class="n">No</span> <span class="n">important</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">K32</span><span class="p">,</span> <span class="n">OR</span> <span class="n">K42</span> <span class="n">IS</span> <span class="n">TOO</span> <span class="n">CLOSE</span> <span class="n">TO</span> <span class="n">AN</span> <span class="n">EIGENVALUE</span>
<span class="p">[</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span> <span class="n">Generation</span> <span class="o">=</span> <span class="mi">00</span><span class="p">,</span> <span class="n">Model</span>     <span class="mi">7</span><span class="p">,</span> <span class="n">Post</span> <span class="n">process</span> <span class="n">R</span> <span class="n">failed</span><span class="p">,</span>    <span class="n">fitness</span> <span class="o">=</span> <span class="mi">99999999</span><span class="p">,</span>    <span class="n">message</span> <span class="o">=</span> <span class="n">NON</span><span class="o">-</span><span class="n">FIXED</span> <span class="n">OMEGA</span> <span class="n">NON</span><span class="o">-</span><span class="n">FIXED</span> <span class="n">PARAMETER</span>
</pre></div>
</div>
<p>Note that (as in the case of human generated NONMEM code) the first 4 models crash, and the <a class="reference internal" href="Glossary.html#crash-value"><span class="std std-ref">crash value</span></a> (99999999) is assigned
to the fitness. There also may be a message: “NON-FIXED OMEGA NON-FIXED PARAMETER”. This is a consequence of the nested tokens. With nested tokens,
there commonly will be tokens that are not used, e.g., covariates relationships for K23 when a cone compartment model (ADVAN1) is selected. A small
penalty should be added (the non-influential token penalty) in this case, simply to prefer this model over the same model without the non-influential
token(s).</p>
<p>The final output from the search should look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Done</span> <span class="k">with</span> <span class="n">final</span> <span class="n">downhill</span> <span class="n">step</span><span class="o">.</span> <span class="n">best</span> <span class="n">fitness</span> <span class="o">=</span> <span class="mf">8504.69692879228</span>
<span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Final</span> <span class="n">output</span> <span class="kn">from</span><span class="w"> </span><span class="nn">best</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span><span class="o">/</span><span class="n">pyDarwin</span><span class="o">/</span><span class="n">example4</span><span class="o">/</span><span class="n">output</span>\<span class="n">FinalResultFile</span><span class="o">.</span><span class="n">lst</span>
<span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unique</span> <span class="n">models</span> <span class="n">to</span> <span class="n">best</span> <span class="n">model</span> <span class="o">=</span> <span class="mi">897</span>
<span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Time</span> <span class="n">to</span> <span class="n">best</span> <span class="n">model</span> <span class="o">=</span> <span class="mf">474.6</span> <span class="n">minutes</span>
<span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Best</span> <span class="n">overall</span> <span class="n">fitness</span> <span class="o">=</span> <span class="mf">8504.696929</span><span class="p">,</span> <span class="n">iteration</span> <span class="mi">05</span><span class="n">S071</span><span class="p">,</span> <span class="n">model</span> <span class="mi">90</span>
<span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="n">Elapsed</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">1015.4</span> <span class="n">minutes</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mark Sale, Certara.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>